{% extends "base.html" %}

{% block title %}Settings - Casey{% endblock %}

{% block extra_styles %}
.settings-section-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--ink-muted);
    padding: 1.25rem 1.25rem 0.5rem;
}

.settings-section-label:first-child {
    padding-top: 0.75rem;
}

.settings-row {
    padding: 0.75rem 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.15s;
    background: var(--parchment);
}

a.settings-row {
    text-decoration: none;
    cursor: pointer;
}

a.settings-row:hover {
    background: var(--surface-hover);
}

.settings-label {
    font-weight: 500;
    font-size: 14px;
    margin-bottom: 0.125rem;
}

.settings-desc {
    font-size: 12px;
    color: var(--ink-muted);
}

.settings-arrow {
    color: var(--ink-muted);
    font-size: 16px;
}

.theme-select {
    display: flex;
    gap: 0.375rem;
}

.theme-option {
    padding: 0.375rem 0.75rem;
    border-radius: var(--radius-xs);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--ink-secondary);
    transition: all 0.15s;
    font-family: var(--font);
    min-height: auto;
}

.theme-option:hover {
    border-color: var(--border-emphasis);
    color: var(--ink);
}

.theme-option.active {
    background: var(--clay-subtle);
    border-color: var(--clay);
    color: var(--clay);
}
{% endblock %}

{% block content %}
<div style="max-width: 600px;">
    <h1 class="page-title">Settings</h1>
    <p class="page-desc">Manage your Casey configuration</p>

    <div class="card">
        <div class="settings-section-label">Journal</div>

        <a href="/settings/templates" class="settings-row">
            <div>
                <div class="settings-label">Journal Templates</div>
                <div class="settings-desc">Customize your writing prompts</div>
            </div>
            <span class="settings-arrow">&rsaquo;</span>
        </a>

        <div class="settings-section-label">Preferences</div>

        <div class="settings-row">
            <div>
                <div class="settings-label">Appearance</div>
                <div class="settings-desc">Choose your preferred theme</div>
            </div>
            <div class="theme-select">
                <button type="button" class="theme-option" data-theme="auto" onclick="setTheme('auto')">Auto</button>
                <button type="button" class="theme-option" data-theme="light" onclick="setTheme('light')">Light</button>
                <button type="button" class="theme-option" data-theme="dark" onclick="setTheme('dark')">Dark</button>
            </div>
        </div>

        <form method="POST" action="/settings/preferences">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

            <div class="settings-row">
                <div style="flex: 1;">
                    <div class="settings-label">Date Format</div>
                    <div class="settings-desc">How dates are displayed throughout the app</div>
                    <div style="margin-top: 0.375rem;">
                        <select name="date_format" style="font-size: 12px; padding: 0.375rem 0.5rem; width: auto;">
                            <option value="dd/mm/yyyy" {{ 'selected' if date_format == 'dd/mm/yyyy' }}>DD/MM/YYYY (10/02/2026)</option>
                            <option value="mm/dd/yyyy" {{ 'selected' if date_format == 'mm/dd/yyyy' }}>MM/DD/YYYY (02/10/2026)</option>
                            <option value="yyyy-mm-dd" {{ 'selected' if date_format == 'yyyy-mm-dd' }}>YYYY-MM-DD (2026-02-10)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <div style="flex: 1;">
                    <div class="settings-label">Daily Blips</div>
                    <div class="settings-desc">How many blips to surface each day</div>
                    <div style="margin-top: 0.375rem;">
                        <select name="daily_blip_count" style="font-size: 12px; padding: 0.375rem 0.5rem; width: auto;">
                            {% for i in range(1, 11) %}
                            <option value="{{ i }}" {{ 'selected' if blip_count == i }}>{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <button type="submit" style="font-size: 12px; padding: 0.375rem 0.75rem; min-height: auto;">Save Preferences</button>
            </div>
        </form>

        <div class="settings-section-label">Account</div>

        <a href="/settings/account" class="settings-row">
            <div>
                <div class="settings-label">Account</div>
                <div class="settings-desc">Signed in as {{ current_user }}</div>
            </div>
            <span class="settings-arrow">&rsaquo;</span>
        </a>

        <a href="/about" class="settings-row">
            <div>
                <div class="settings-label">About Casey</div>
                <div class="settings-desc">The story behind the app</div>
            </div>
            <span class="settings-arrow">&rsaquo;</span>
        </a>

        <div class="settings-section-label">Data</div>

        <div class="settings-row">
            <div>
                <div class="settings-label">Export Data</div>
                <div class="settings-desc">Download all your data</div>
                <div style="margin-top: 0.375rem; display: flex; gap: 0.75rem;">
                    <a href="/export/json" style="color: var(--clay); text-decoration: none; font-size: 12px; font-weight: 500;">Download JSON</a>
                    <a href="/export/csv" style="color: var(--clay); text-decoration: none; font-size: 12px; font-weight: 500;">Download CSV</a>
                </div>
            </div>
        </div>

        <div class="settings-row">
            <div style="flex: 1;">
                <div class="settings-label">Import Data</div>
                <div class="settings-desc">Restore from a Casey JSON export</div>
                <form method="POST" action="/import/json" enctype="multipart/form-data" style="margin-top: 0.375rem; display: flex; gap: 0.5rem; align-items: center;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <input type="file" name="file" accept=".json" required style="font-size: 12px; color: var(--ink-secondary);">
                    <button type="submit" style="font-size: 12px; padding: 0.375rem 0.75rem; min-height: auto;">Import</button>
                </form>
            </div>
        </div>

        <a href="/settings/api" class="settings-row">
            <div>
                <div class="settings-label">API Settings</div>
                <div class="settings-desc">Manage personal access tokens</div>
            </div>
            <span class="settings-arrow">&rsaquo;</span>
        </a>

        <div class="settings-section-label">Admin</div>

        {% if is_admin %}
        <a href="/admin" class="settings-row">
            <div>
                <div class="settings-label">Admin Panel</div>
                <div class="settings-desc">System overview and user management</div>
            </div>
            <span class="settings-arrow">&rsaquo;</span>
        </a>
        {% endif %}

        <div class="settings-row">
            <div>
                <div class="settings-label">Version</div>
                <div class="settings-desc">v{{ version }}</div>
                <div style="margin-top: 0.375rem; display: flex; gap: 0.75rem;">
                    <a href="https://github.com/dannymorris/casey" style="color: var(--clay); text-decoration: none; font-size: 12px; font-weight: 500;">GitHub</a>
                    <a href="https://github.com/dannymorris/casey/issues" style="color: var(--clay); text-decoration: none; font-size: 12px; font-weight: 500;">Issues</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function setTheme(theme) {
    localStorage.setItem('casey-theme', theme);
    var html = document.documentElement;
    html.removeAttribute('data-theme');
    if (theme === 'dark') html.setAttribute('data-theme', 'dark');
    else if (theme === 'light') html.setAttribute('data-theme', 'light');
    updateButtons(theme);
}

function updateButtons(active) {
    document.querySelectorAll('.theme-option').forEach(function(btn) {
        btn.classList.toggle('active', btn.getAttribute('data-theme') === active);
    });
}

// Init active state
updateButtons(localStorage.getItem('casey-theme') || 'auto');
</script>
{% endblock %}
